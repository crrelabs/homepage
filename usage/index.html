<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex, nofollow">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenClaw Usage Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f1117; color: #e0e0e0; padding: 24px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .header h1 { font-size: 24px; color: #fff; }
        .header .updated { color: #888; font-size: 13px; }
        .filter-bar { background: #1a1d27; border-radius: 12px; padding: 16px 20px; border: 1px solid #2a2d37; margin-bottom: 24px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .filter-bar label { color: #888; font-size: 13px; font-weight: 500; }
        .filter-bar input[type="date"] { background: #0f1117; border: 1px solid #2a2d37; color: #e0e0e0; padding: 6px 10px; border-radius: 6px; font-size: 13px; font-family: inherit; }
        .filter-bar input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.7); }
        .filter-btn { background: #2a2d37; color: #aaa; border: 1px solid #363a47; padding: 6px 14px; border-radius: 6px; font-size: 12px; cursor: pointer; font-family: inherit; transition: all 0.15s; }
        .filter-btn:hover { background: #363a47; color: #fff; }
        .filter-btn.active { background: #3498db; color: #fff; border-color: #3498db; }
        .stat-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-box { background: #1a1d27; border-radius: 12px; padding: 20px; border: 1px solid #2a2d37; }
        .stat-value { font-size: 28px; font-weight: 700; color: #fff; }
        .stat-label { font-size: 13px; color: #888; margin-top: 4px; }
        .card { background: #1a1d27; border-radius: 12px; padding: 24px; border: 1px solid #2a2d37; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 16px; color: #888; font-weight: 500; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #2a2d37; }
        td { padding: 14px 16px; border-bottom: 1px solid #1f222d; font-size: 14px; }
        tr:hover { background: #1f222d; }
        .chart-container { height: 300px; margin-top: 24px; }
        .pct-bar { background:#ecf0f1;border-radius:4px;overflow:hidden;height:20px;width:120px;display:inline-block;vertical-align:middle; }
        .pct-fill { height:100%; }
        .anomaly-row { background: #2d1b1b !important; border-left: 3px solid #e74c3c; }
        .cron-issue { color: #e74c3c; }
        .cron-normal { color: #888; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ¦ž OpenClaw Usage Dashboard</h1>
        <div class="updated">Last updated: February 14, 2026 at 09:15 AM ET</div>
    </div>

    <div class="filter-bar">
        <label>From</label>
        <input type="date" id="dateFrom">
        <label>To</label>
        <input type="date" id="dateTo">
        <div style="display:flex;gap:6px;margin-left:8px;">
            <button class="filter-btn" onclick="setPreset('today')">Today</button>
            <button class="filter-btn" onclick="setPreset('7d')">Last 7 Days</button>
            <button class="filter-btn" onclick="setPreset('30d')">Last 30 Days</button>
            <button class="filter-btn" onclick="setPreset('month')">This Month</button>
            <button class="filter-btn" onclick="setPreset('all')">All Time</button>
        </div>
    </div>

    <div class="stat-row" id="summaryStats"></div>

    <div class="card" id="clientCard">
        <h3 style="margin-bottom:16px;" id="clientTitle"></h3>
        <table>
            <thead><tr>
                <th>Client</th><th style="text-align:right;">Cost</th><th style="text-align:right;">Requests</th>
                <th style="text-align:right;">Tokens</th><th style="text-align:right;">Share</th>
            </tr></thead>
            <tbody id="clientBody"></tbody>
        </table>
    </div>

    <div class="card" style="margin-top:24px;" id="apiCard">
        <h3 style="margin-bottom:16px;" id="apiTitle"></h3>
        <table>
            <thead><tr>
                <th>Service</th><th>Model</th><th style="text-align:right;">Input Tokens</th>
                <th style="text-align:right;">Output Tokens</th><th style="text-align:right;">Requests</th>
                <th style="text-align:right;">Cost</th>
            </tr></thead>
            <tbody id="apiBody"></tbody>
        </table>
    </div>

    <div class="card" style="margin-top:24px;" id="agentCard">
        <h3 style="margin-bottom:16px;" id="agentTitle"></h3>
        <table>
            <thead><tr>
                <th>Agent</th><th style="text-align:right;">Cost</th><th style="text-align:right;">Share</th>
            </tr></thead>
            <tbody id="agentBody"></tbody>
        </table>
    </div>

    <div class="card" style="margin-top:24px;" id="cronCard">
        <h3 style="margin-bottom:16px;" id="cronTitle"></h3>
        <table>
            <thead><tr>
                <th>Cron Job</th><th>Model</th><th style="text-align:right;">Runs</th>
                <th style="text-align:right;">Avg Duration</th><th style="text-align:right;">Issues</th>
                <th style="text-align:right;">Cost</th><th style="text-align:right;">Trend</th>
            </tr></thead>
            <tbody id="cronBody"></tbody>
        </table>
    </div>

    <div class="card" style="margin-top:24px;" id="twilioCard" style="display:none;">
        <h3 id="twilioTitle"></h3>
        <div class="stat-row" id="twilioStats"></div>
        <p style="color:#999;font-size:12px;">Billed to: Rovira Property Management</p>
    </div>

    <div class="card" style="margin-top:24px;">
        <h3 id="chartTitle">Daily Cost Trend</h3>
        <div class="chart-container">
            <canvas id="dailyChart"></canvas>
        </div>
    </div>

    <p style="text-align:center;color:#555;font-size:12px;margin-top:32px;">
        Generated by Iris Brown ðŸŒ¸ Â· Data from OpenClaw session logs + Twilio API
    </p>

    <script>
    const RAW = [{"d":"2026-02-13","c":"CRRE Labs (Internal)","a":"lex","m":"claude-opus-4-6","cost":30.524677,"it":375,"ot":58608,"cr":23283016,"cw":2786575,"tt":26128574,"r":231},{"d":"2026-02-13","c":"CRRE Labs (Internal)","a":"lex","m":"delivery-mirror","cost":0,"it":0,"ot":0,"cr":0,"cw":0,"tt":0,"r":4},{"d":"2026-02-14","c":"CRRE Labs (Internal)","a":"lex","m":"claude-opus-4-6","cost":3.453225,"it":45,"ot":6720,"cr":1319275,"cw":420058,"tt":1746098,"r":23},{"d":"2026-02-14","c":"Rovira PM","a":"moneypenny","m":"claude-opus-4-6","cost":0.250263,"it":25,"ot":1047,"cr":96514,"cw":28113,"tt":125699,"r":9},{"d":"2026-02-14","c":"Etsy Store","a":"elara","m":"claude-opus-4-6","cost":1.479304,"it":57,"ot":10236,"cr":528237,"cw":153440,"tt":691970,"r":35},{"d":"2026-02-14","c":"Etsy Store","a":"elara","m":"delivery-mirror","cost":0,"it":0,"ot":0,"cr":0,"cw":0,"tt":0,"r":1},{"d":"2026-02-13","c":"Personal (Travel)","a":"ellie","m":"claude-opus-4-6","cost":4.542445,"it":97,"ot":23387,"cr":3992758,"cw":313745,"tt":4329987,"r":65},{"d":"2026-02-14","c":"Personal (Travel)","a":"ellie","m":"claude-opus-4-6","cost":0.757884,"it":16,"ot":1315,"cr":143770,"cw":104487,"tt":249588,"r":12},{"d":"2026-02-13","c":"Rovira PM","a":"main","m":"claude-opus-4-6","cost":80.750773,"it":1232,"ot":213968,"cr":64507951,"cw":6902630,"tt":71625781,"r":894},{"d":"2026-02-14","c":"Rovira PM","a":"main","m":"claude-opus-4-6","cost":19.15387,"it":251,"ot":29025,"cr":4222329,"cw":2610532,"tt":6862137,"r":143},{"d":"2026-02-14","c":"Rovira PM","a":"main","m":"claude-sonnet-4-20250514","cost":0.577611,"it":101,"ot":14154,"cr":747399,"cw":37541,"tt":799195,"r":28},{"d":"2026-02-12","c":"Rovira PM","a":"main","m":"claude-opus-4-6","cost":30.759058,"it":547,"ot":81152,"cr":25479958,"cw":2558007,"tt":28119664,"r":376},{"d":"2026-02-13","c":"Rovira PM","a":"main","m":"delivery-mirror","cost":0,"it":0,"ot":0,"cr":0,"cw":0,"tt":0,"r":6}];
    const TWILIO = {"cost":9.943400000000015,"outbound":444,"inbound":2,"messages":446};
    const CRON = [{"name":"Award Flight Monitor - CAG hubs to MIA Business","model":"claude-opus-4-6","runs":1,"avg_duration":0.7945,"timeouts":1,"errors":0,"cost":0.18738825000000003,"cost_trend":"up","long_runs":0,"has_anomalies":true},{"name":"Delinquency Update - 9AM","model":"claude-opus-4-6","runs":3,"avg_duration":4.042305555555556,"timeouts":3,"errors":1,"cost":2.8676915,"cost_trend":"up","long_runs":0,"has_anomalies":true},{"name":"Collections - Monitor Responses","model":"claude-opus-4-6","runs":12,"avg_duration":0.2416805555555556,"timeouts":12,"errors":0,"cost":1.1752937500000002,"cost_trend":"up","long_runs":1,"has_anomalies":true},{"name":"Collections - Daily Outreach","model":"claude-opus-4-6","runs":1,"avg_duration":5.998683333333333,"timeouts":1,"errors":0,"cost":0.9119144999999999,"cost_trend":"up","long_runs":0,"has_anomalies":true},{"name":"Delinquency Update - 3PM","model":"claude-opus-4-6","runs":1,"avg_duration":5.000266666666667,"timeouts":1,"errors":0,"cost":1.01556575,"cost_trend":"up","long_runs":0,"has_anomalies":true},{"name":"Nightly GitHub Backup","model":"claude-opus-4-6","runs":2,"avg_duration":0.22063333333333335,"timeouts":2,"errors":0,"cost":0.23331375000000004,"cost_trend":"up","long_runs":0,"has_anomalies":true},{"name":"Delinquency Update - 12PM","model":"claude-opus-4-6","runs":1,"avg_duration":3.8094166666666665,"timeouts":1,"errors":1,"cost":0.73586025,"cost_trend":"up","long_runs":0,"has_anomalies":true}];
    const MODEL_DISPLAY = {"claude-opus-4-6":"Claude Opus 4","claude-sonnet-4-20250514":"Claude Sonnet 4","claude-sonnet-4-20250514-fast":"Claude Sonnet 4 (Fast)","claude-haiku-3-5":"Claude Haiku 3.5"};
    const CLIENT_COLORS = {"Rovira PM":"#2c3e50","CRRE Labs (Internal)":"#8e44ad","Melo Group":"#e67e22","Personal (Travel)":"#27ae60","Etsy Store":"#f39c12"};
    const AGENT_NAMES = {"main":"Iris","lex":"Lex","ellie":"Ellie","elara":"Elara","moneypenny":"Moneypenny"};
    const AGENT_COLORS = {"main":"#3498db","lex":"#8e44ad","ellie":"#e74c3c","elara":"#f39c12","moneypenny":"#16a085"};
    const ALL_CLIENTS = ["Rovira PM","CRRE Labs (Internal)","Melo Group","Personal (Travel)","Etsy Store"];
    const ALL_AGENTS = ["main","lex","ellie","elara","moneypenny"];
    const TODAY = '2026-02-14';
    const TOTAL_CRON_COST = 7.127028;
    const OPUS_COST = 7.127028;
    const SONNET_COST = 0.000000;

    let chart = null;
    const $from = document.getElementById('dateFrom');
    const $to = document.getElementById('dateTo');

    function fmt(n, d=4) { return '$' + n.toLocaleString('en-US', {minimumFractionDigits:d,maximumFractionDigits:d}); }
    function fmtInt(n) { return n.toLocaleString('en-US'); }

    function setPreset(p) {
        const t = new Date(TODAY);
        let from, to = TODAY;
        if (p === 'today') { from = TODAY; }
        else if (p === '7d') { const d = new Date(t); d.setDate(d.getDate()-6); from = d.toISOString().slice(0,10); }
        else if (p === '30d') { const d = new Date(t); d.setDate(d.getDate()-29); from = d.toISOString().slice(0,10); }
        else if (p === 'month') { from = TODAY.slice(0,7) + '-01'; }
        else { from = ''; to = ''; }
        $from.value = from;
        $to.value = to;
        updateAll();
        // highlight active button
        document.querySelectorAll('.filter-btn').forEach((b,i) => {
            b.classList.toggle('active', b.textContent.trim() === (
                p === 'today' ? 'Today' : p === '7d' ? 'Last 7 Days' : p === '30d' ? 'Last 30 Days' : p === 'month' ? 'This Month' : 'All Time'));
        });
    }

    function getFiltered() {
        const f = $from.value, t = $to.value;
        return RAW.filter(r => (!f || r.d >= f) && (!t || r.d <= t));
    }

    function rangeLabel() {
        const f = $from.value, t = $to.value;
        if (!f && !t) return 'All Time';
        if (f === t && f === TODAY) return 'Today';
        if (f && t) return f + ' â†’ ' + t;
        if (f) return 'From ' + f;
        return 'Up to ' + t;
    }

    function updateAll() {
        const data = getFiltered();
        const label = rangeLabel();

        // Summary
        let totalCost = 0, totalReq = 0, totalTok = 0;
        data.forEach(r => { totalCost += r.cost; totalReq += r.r; totalTok += r.tt; });
        
        // Calculate efficiency metrics
        const daysInPeriod = $from.value && $to.value ? Math.max(1, Math.floor((new Date($to.value) - new Date($from.value)) / (1000*60*60*24)) + 1) : 30;
        const costPerDay = totalCost / daysInPeriod;
        const monthlyProjection = costPerDay * 30;
        const totalModelCost = OPUS_COST + SONNET_COST;
        const opusPercent = totalModelCost > 0 ? (OPUS_COST / totalModelCost * 100) : 0;
        const sonnetPercent = totalModelCost > 0 ? (SONNET_COST / totalModelCost * 100) : 0;
        
        document.getElementById('summaryStats').innerHTML = `
            <div class="stat-box"><div class="stat-value">${fmt(totalCost,2)}</div><div class="stat-label">Total Cost (${label})</div></div>
            <div class="stat-box"><div class="stat-value">${fmt(data.filter(r=>r.d===TODAY).reduce((s,r)=>s+r.cost,0),4)}</div><div class="stat-label">Today's Cost</div></div>
            <div class="stat-box"><div class="stat-value">${fmt(costPerDay,2)}</div><div class="stat-label">Cost/Day (Avg)</div></div>
            <div class="stat-box"><div class="stat-value">${fmt(monthlyProjection,0)}</div><div class="stat-label">Monthly Projection</div></div>
            <div class="stat-box"><div class="stat-value">${opusPercent.toFixed(0)}%</div><div class="stat-label">Opus Split</div></div>
            <div class="stat-box"><div class="stat-value">${fmtInt(totalReq)}</div><div class="stat-label">API Requests</div></div>
        `;

        // Client breakdown
        const clients = {};
        ALL_CLIENTS.forEach(c => clients[c] = {cost:0,r:0,tt:0});
        data.forEach(r => {
            if (!clients[r.c]) clients[r.c] = {cost:0,r:0,tt:0};
            clients[r.c].cost += r.cost; clients[r.c].r += r.r; clients[r.c].tt += r.tt;
        });
        const grand = Object.values(clients).reduce((s,c)=>s+c.cost,0) || 1;
        document.getElementById('clientTitle').textContent = 'Cost by Client â€” ' + label;
        let cRows = '';
        Object.entries(clients).sort((a,b)=>b[1].cost-a[1].cost).forEach(([name,d]) => {
            const color = CLIENT_COLORS[name] || '#7f8c8d';
            const pct = d.cost/grand*100;
            cRows += `<tr><td><span style="display:inline-block;width:12px;height:12px;border-radius:3px;background:${color};margin-right:8px;vertical-align:middle;"></span>${name}</td>
                <td style="text-align:right;font-weight:600;">${fmt(d.cost)}</td>
                <td style="text-align:right;">${fmtInt(d.r)}</td>
                <td style="text-align:right;">${fmtInt(d.tt)}</td>
                <td style="text-align:right;"><div class="pct-bar"><div class="pct-fill" style="background:${color};width:${pct.toFixed(1)}%"></div></div> ${pct.toFixed(1)}%</td></tr>`;
        });
        document.getElementById('clientBody').innerHTML = cRows;

        // API/Model breakdown
        const models = {};
        data.forEach(r => {
            if (!models[r.m]) models[r.m] = {cost:0,it:0,ot:0,r:0};
            models[r.m].cost += r.cost; models[r.m].it += r.it; models[r.m].ot += r.ot; models[r.m].r += r.r;
        });
        document.getElementById('apiTitle').textContent = 'âš¡ API & Model Breakdown â€” ' + label;
        let mRows = '';
        let apiTotal = 0;
        Object.entries(models).sort((a,b)=>b[1].cost-a[1].cost).forEach(([mid,d]) => {
            apiTotal += d.cost;
            mRows += `<tr><td>Anthropic</td><td>${MODEL_DISPLAY[mid]||mid}</td>
                <td style="text-align:right;">${fmtInt(d.it)}</td><td style="text-align:right;">${fmtInt(d.ot)}</td>
                <td style="text-align:right;">${fmtInt(d.r)}</td><td style="text-align:right;font-weight:600;">${fmt(d.cost)}</td></tr>`;
        });
        // Twilio row (only if in range that includes current month data)
        if (TWILIO.messages > 0) {
            mRows += `<tr><td>Twilio</td><td>SMS</td><td style="text-align:right;">â€”</td><td style="text-align:right;">â€”</td>
                <td style="text-align:right;">${fmtInt(TWILIO.messages)}</td><td style="text-align:right;font-weight:600;">${fmt(TWILIO.cost)}</td></tr>`;
            apiTotal += TWILIO.cost;
        }
        mRows += `<tr style="border-top:2px solid #2a2d37;font-weight:700;"><td colspan="5">Total</td><td style="text-align:right;">${fmt(apiTotal)}</td></tr>`;
        document.getElementById('apiBody').innerHTML = mRows;

        // Agent allocation
        const agents = {};
        ALL_AGENTS.forEach(a => agents[a] = {cost:0,r:0,tt:0});
        data.forEach(r => {
            if (!agents[r.a]) agents[r.a] = {cost:0,r:0,tt:0};
            agents[r.a].cost += r.cost; agents[r.a].r += r.r; agents[r.a].tt += r.tt;
        });
        const agentGrand = Object.values(agents).reduce((s,a)=>s+a.cost,0) || 1;
        document.getElementById('agentTitle').textContent = 'ðŸ¤– Agent Allocation â€” ' + label;
        let aRows = '';
        ALL_AGENTS.forEach(aid => {
            const d = agents[aid] || {cost:0};
            const color = AGENT_COLORS[aid]; const name = AGENT_NAMES[aid];
            const pct = d.cost/agentGrand*100;
            aRows += `<tr><td><span style="display:inline-block;width:12px;height:12px;border-radius:3px;background:${color};margin-right:8px;vertical-align:middle;"></span>${name}</td>
                <td style="text-align:right;font-weight:600;">${fmt(d.cost)}</td>
                <td style="text-align:right;"><div class="pct-bar"><div class="pct-fill" style="background:${color};width:${pct.toFixed(1)}%"></div></div> ${pct.toFixed(1)}%</td></tr>`;
        });
        document.getElementById('agentBody').innerHTML = aRows;

        // Cron Job Performance
        document.getElementById('cronTitle').textContent = 'â° Cron Job Performance â€” ' + label;
        let cronRows = '';
        if (CRON.length > 0) {
            CRON.forEach(job => {
                const modelDisplay = MODEL_DISPLAY[job.model] || job.model;
                const trendIcon = job.cost_trend === 'up' ? 'ðŸ“ˆ' : job.cost_trend === 'down' ? 'ðŸ“‰' : 'âž¡ï¸';
                const anomalyFlag = job.has_anomalies ? 'âš ï¸ ' : '';
                const issueDetails = [];
                if (job.timeouts > 0) issueDetails.push(`${job.timeouts} timeout${job.timeouts > 1 ? 's' : ''}`);
                if (job.errors > 0) issueDetails.push(`${job.errors} error${job.errors > 1 ? 's' : ''}`);
                if (job.long_runs > 0) issueDetails.push(`${job.long_runs} slow run${job.long_runs > 1 ? 's' : ''}`);
                const issuesText = issueDetails.length > 0 ? issueDetails.join(', ') : 'â€”';
                
                cronRows += `<tr ${job.has_anomalies ? 'class="anomaly-row"' : ''}>
                    <td>${anomalyFlag}${job.name}</td>
                    <td>${modelDisplay}</td>
                    <td style="text-align:right;">${job.runs}</td>
                    <td style="text-align:right;">${job.avg_duration.toFixed(1)}m</td>
                    <td style="text-align:right;" class="${job.has_anomalies ? 'cron-issue' : 'cron-normal'}">${issuesText}</td>
                    <td style="text-align:right;font-weight:600;">${fmt(job.cost)}</td>
                    <td style="text-align:right;">${trendIcon}</td>
                </tr>`;
            });
        } else {
            cronRows = '<tr><td colspan="7" style="text-align:center;color:#888;font-style:italic;">No cron job data available</td></tr>';
        }
        document.getElementById('cronBody').innerHTML = cronRows;

        // Twilio card
        const tCard = document.getElementById('twilioCard');
        if (TWILIO.messages > 0) {
            tCard.style.display = '';
            document.getElementById('twilioTitle').textContent = 'ðŸ“± Twilio SMS â€” ' + label;
            document.getElementById('twilioStats').innerHTML = `
                <div class="stat-box"><div class="stat-value">${TWILIO.cost.toFixed(2)}</div><div class="stat-label">SMS Cost</div></div>
                <div class="stat-box"><div class="stat-value">${TWILIO.outbound}</div><div class="stat-label">Outbound</div></div>
                <div class="stat-box"><div class="stat-value">${TWILIO.inbound}</div><div class="stat-label">Inbound</div></div>`;
        } else { tCard.style.display = 'none'; }

        // Daily chart
        const dailyMap = {};
        data.forEach(r => {
            if (!dailyMap[r.d]) dailyMap[r.d] = {};
            dailyMap[r.d][r.c] = (dailyMap[r.d][r.c]||0) + r.cost;
        });
        const dates = Object.keys(dailyMap).sort();
        const datasets = ALL_CLIENTS.map(c => ({
            label: c,
            data: dates.map(d => Math.round((dailyMap[d]?.[c]||0)*10000)/10000),
            backgroundColor: CLIENT_COLORS[c] || '#7f8c8d',
        }));
        document.getElementById('chartTitle').textContent = 'Daily Cost Trend â€” ' + label;
        if (chart) chart.destroy();
        chart = new Chart(document.getElementById('dailyChart').getContext('2d'), {
            type: 'bar',
            data: { labels: dates.map(d => d.slice(5)), datasets },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#aaa', font: { size: 12 } } } },
                scales: {
                    x: { stacked: true, ticks: { color: '#666' }, grid: { color: '#1f222d' } },
                    y: { stacked: true, ticks: { color: '#666', callback: v => '$'+v.toFixed(2) }, grid: { color: '#1f222d' } }
                }
            }
        });
    }

    $from.addEventListener('change', () => { document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); updateAll(); });
    $to.addEventListener('change', () => { document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); updateAll(); });

    // Default to "This Month"
    setPreset('month');
    </script>
</body>
</html>